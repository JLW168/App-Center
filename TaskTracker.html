<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JLW Task Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .sortable-ghost { background: #c0dcfc; border-radius: 0.5rem; }
        .sortable-drag { opacity: 1 !important; }
        .task-card { transition: background-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out; }
        .kanban-column-body::-webkit-scrollbar { width: 8px; }
        .kanban-column-body::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 10px; }
        .kanban-column-body::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .kanban-column-body::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-slate-100">
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, setPersistence, browserSessionPersistence, browserLocalPersistence, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, getDocs, addDoc, doc, getDoc, updateDoc, deleteDoc, onSnapshot, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import React, { useState, useEffect, useRef, createContext, useContext } from "https://esm.sh/react@18.2.0";
        import ReactDOM from "https://esm.sh/react-dom@18.2.0/client";

        const firebaseConfig = {
            apiKey: "AIzaSyBNb5ZI9XIWWSpxGD-FeV94K5FMc2a8udU",
            authDomain: "hr-manager-84ada.firebaseapp.com",
            projectId: "hr-manager-84ada",
            storageBucket: "hr-manager-84ada.firebasestorage.app",
            messagingSenderId: "365563456537",
            appId: "1:365563456537:web:9c5a6fbce7710b4c72ce88",
            measurementId: "G-51R9KT7LC1"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const AuthContext = createContext();

        const AuthProvider = ({ children }) => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const unsubscribe = onAuthStateChanged(auth, (user) => {
                    setUser(user);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            return React.createElement(AuthContext.Provider, { value: { user, loading } }, children);
        };

        const useAuth = () => useContext(AuthContext);

        const App = () => {
            const { user, loading } = useAuth();
            if (loading) return React.createElement("div", { className: "flex justify-center items-center min-h-screen" }, "Loading...");
            return user ? React.createElement(TaskTracker) : React.createElement(Login);
        };
        
        const Login = () => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [rememberMe, setRememberMe] = useState(false);
            const [error, setError] = useState('');
            const [showPassword, setShowPassword] = useState(false);

            const handleLogin = async (e) => {
                e.preventDefault();
                setError('');
                try {
                    const persistence = rememberMe ? browserLocalPersistence : browserSessionPersistence;
                    await setPersistence(auth, persistence);
                    await signInWithEmailAndPassword(auth, email, password);
                } catch (err) {
                    let message = 'An unknown error occurred.';
                    switch (err.code) {
                        case 'auth/invalid-email': message = 'Please enter a valid email address.'; break;
                        case 'auth/user-not-found':
                        case 'auth/wrong-password':
                        case 'auth/invalid-credential': message = 'Invalid email or password.'; break;
                        case 'auth/too-many-requests': message = 'Access to this account has been temporarily disabled.'; break;
                    }
                    setError(message);
                }
            };

            return React.createElement("div", { className: "flex items-center justify-center min-h-screen p-4" },
                React.createElement("div", { className: "w-full max-w-5xl bg-white rounded-2xl shadow-2xl flex flex-col md:flex-row overflow-hidden" },
                    React.createElement("div", { className: "w-full md:w-1/2 bg-slate-800 p-8 sm:p-12 flex-col justify-center items-center text-white hidden md:flex" },
                        React.createElement("div", { className: "max-w-xs" },
                            React.createElement("svg", { className: "w-full h-auto mb-6", viewBox: "0 0 512 512", fill: "none", xmlns: "http://www.w3.org/2000/svg" }, React.createElement("path", { d: "M368 128H144C126.3 128 112 142.3 112 160V416C112 433.7 126.3 448 144 448H368C385.7 448 400 433.7 400 416V160C400 142.3 385.7 128 368 128ZM256 64C269.8 64 282.8 68.88 292.8 76.8L336.2 109.5C340.6 112.8 346.5 112.5 350.5 108.5L364.5 94.5C368.5 90.5 370.2 84.98 368.8 79.88C359.1 43.8 322.2 16 280 16C222.2 16 176 62.15 176 120V128H208V120C208 84.33 228.3 64 256 64ZM240 248C240 243.6 243.6 240 248 240H328C332.4 240 336 243.6 336 248C336 252.4 332.4 256 328 256H248C243.6 256 240 252.4 240 248ZM248 320H328C332.4 320 336 323.6 336 328C336 332.4 332.4 336 328 336H248C243.6 336 240 332.4 240 328C240 323.6 243.6 320 248 320ZM184 256C193.9 256 201.6 248.4 201.6 238.4C201.6 228.5 193.9 220.8 184 220.8C174.1 220.8 166.4 228.5 166.4 238.4C166.4 248.4 174.1 256 184 256ZM184 336C193.9 336 201.6 328.4 201.6 318.4C201.6 308.5 193.9 300.8 184 300.8C174.1 300.8 166.4 308.5 166.4 318.4C166.4 328.4 174.1 336 184 336Z", fill: "#38bdf8" })),
                            React.createElement("h2", { className: "text-3xl font-bold leading-tight" }, "Streamline Your Workflow"),
                            React.createElement("p", { className: "mt-2 text-slate-300" }, "Manage tasks, track progress, and collaborate with your team efficiently.")
                        )
                    ),
                    React.createElement("div", { className: "w-full md:w-1/2 p-8 sm:p-12 flex flex-col justify-center" },
                        React.createElement("div", { className: "w-full max-w-sm mx-auto" },
                            React.createElement("h2", { className: "text-3xl font-bold text-slate-900" }, "JLW Task Tracker"),
                            React.createElement("p", { className: "mt-2 text-slate-600" }, "Welcome! Please sign in to your account."),
                            React.createElement("p", { className: "mt-4 text-sm font-semibold text-center text-red-600 bg-red-100 p-3 rounded-lg" }, "This application is used for Internal USE ONLY!"),
                            React.createElement("form", { onSubmit: handleLogin, className: "mt-8 space-y-6" },
                                error && React.createElement("div", { className: "p-3 bg-red-100 text-red-700 rounded-md text-sm" }, error),
                                React.createElement("div", null,
                                    React.createElement("label", { htmlFor: "email", className: "block text-sm font-medium text-slate-700" }, "Email address"),
                                    React.createElement("div", { className: "mt-1" }, React.createElement("input", { id: "email", name: "email", type: "email", value: email, onChange: (e) => setEmail(e.target.value), required: true, className: "w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" }))
                                ),
                                React.createElement("div", null,
                                    React.createElement("label", { htmlFor: "password", className: "block text-sm font-medium text-slate-700" }, "Password"),
                                    React.createElement("div", { className: "mt-1 relative" },
                                        React.createElement("input", { id: "password", name: "password", type: showPassword ? "text" : "password", value: password, onChange: (e) => setPassword(e.target.value), required: true, className: "w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 pr-10" }),
                                        React.createElement("button", { type: "button", onClick: () => setShowPassword(!showPassword), className: "absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-slate-600" },
                                            showPassword ? React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: "h-5 w-5", viewBox: "0 0 20 20", fill: "currentColor" }, React.createElement("path", { fillRule: "evenodd", d: "M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074L3.707 2.293zM10 12a2 2 0 100-4 2 2 0 000 4z", clipRule: "evenodd" }), React.createElement("path", { d: "M2 10s.939-1.761 2.63-3.262A10.034 10.034 0 0110 5c1.29 0 2.522.342 3.638.95-1.595.68-2.89 1.93-3.638 3.462A9.948 9.948 0 012 10z" }))
                                                       : React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: "h-5 w-5", viewBox: "0 0 20 20", fill: "currentColor" }, React.createElement("path", { d: "M10 12a2 2 0 100-4 2 2 0 000 4z" }), React.createElement("path", { fillRule: "evenodd", d: "M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.022 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z", clipRule: "evenodd" }))
                                        )
                                    )
                                ),
                                React.createElement("div", { className: "flex items-center justify-between" },
                                    React.createElement("div", { className: "flex items-center" },
                                        React.createElement("input", { id: "remember-me", name: "remember-me", type: "checkbox", checked: rememberMe, onChange: (e) => setRememberMe(e.target.checked), className: "h-4 w-4 text-blue-600 focus:ring-blue-500 border-slate-300 rounded" }),
                                        React.createElement("label", { htmlFor: "remember-me", className: "ml-2 block text-sm text-slate-900" }, "Remember me")
                                    ),
                                    React.createElement("div", { className: "text-sm" }, React.createElement("a", { href: "#", className: "font-medium text-blue-600 hover:text-blue-500" }, "Forgot your password?"))
                                ),
                                React.createElement("div", null, React.createElement("button", { type: "submit", className: "w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" }, "Sign in"))
                            )
                        )
                    )
                )
            );
        };

        const TaskTracker = () => {
            const { user } = useAuth();
            const [tasks, setTasks] = useState([]);
            const [history, setHistory] = useState([]);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [editingTask, setEditingTask] = useState(null);
            const [filters, setFilters] = useState({ shop: '', staff: '', date: '' });
            const [shopOptions, setShopOptions] = useState([]);
            const [staffOptions, setStaffOptions] = useState([]);

            const tasksCollection = collection(db, 'users', user.uid, 'tasks');
            const historyCollection = collection(db, 'users', user.uid, 'history');

            useEffect(() => {
                const q = query(tasksCollection);
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    const tasksData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setTasks(tasksData);
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                const q = query(historyCollection, orderBy('completedTimestamp', 'desc'));
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    const historyData = snapshot.docs.map(doc => {
                        const data = doc.data();
                        return { id: doc.id, ...data };
                    });
                    setHistory(historyData);
                });
                return () => unsubscribe();
            }, []);
            
            useEffect(() => {
                const populateOptions = async (collectionName, setter) => {
                    const querySnapshot = await getDocs(collection(db, collectionName));
                    const options = querySnapshot.docs.map(doc => doc.data().name).filter(Boolean);
                    setter(options);
                };
                populateOptions('shops', setShopOptions);
                populateOptions('supervisors', setStaffOptions);
            }, []);

            const openModal = (task = null) => {
                setEditingTask(task);
                setIsModalOpen(true);
            };

            const closeModal = () => {
                setIsModalOpen(false);
                setEditingTask(null);
            };

            const handleSaveTask = async (taskData) => {
                if (editingTask) {
                    // Only tasks from the main board can be edited now.
                    // History tasks are read-only.
                    if(editingTask.status !== 'done') {
                         const taskRef = doc(tasksCollection, editingTask.id);
                         await updateDoc(taskRef, taskData);
                    }
                } else {
                    await addDoc(tasksCollection, { ...taskData, status: 'todo', createdAt: serverTimestamp() });
                }
                closeModal();
            };
            
            const handleDeleteTask = async (id) => {
                await deleteDoc(doc(tasksCollection, id));
            };

            const handleDrop = async (item, newStatus) => {
                const taskToMove = tasks.find(t => t.id === item.id);
                if (!taskToMove) {
                    console.error("Task not found on drop:", item.id);
                    return;
                }

                if (newStatus === 'done') {
                    const { id, ...taskData } = taskToMove;
                    const taskRef = doc(tasksCollection, taskToMove.id);
                    await addDoc(historyCollection, { ...taskData, status: 'done', completedTimestamp: serverTimestamp() });
                    await deleteDoc(taskRef);
                    confetti({ particleCount: 150, spread: 90, origin: { x: 0.5, y: 0.5 }, gravity: 1.2 });
                } else {
                    const taskRef = doc(tasksCollection, taskToMove.id);
                    await updateDoc(taskRef, { status: newStatus });
                }
            };
            
            const filteredHistory = history.filter(task => {
                const shopMatch = filters.shop ? task.shopName === filters.shop : true;
                const staffMatch = filters.staff ? task.staffName === filters.staff : true;
                const dateMatch = filters.date ? new Date(task.completedTimestamp?.seconds * 1000).toISOString().split('T')[0] === filters.date : true;
                return shopMatch && staffMatch && dateMatch;
            });

            return React.createElement("div", { className: "container mx-auto p-4 sm:p-6 lg:p-8" },
                React.createElement(Header, { onSignOut: () => signOut(auth) }),
                React.createElement("div", { className: "flex justify-center mb-8" },
                    React.createElement("button", { onClick: () => openModal(), className: "bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 transition-transform transform hover:scale-105" }, "+ Add New Task")
                ),
                React.createElement(KanbanBoard, { tasks, onDrop: handleDrop, onEdit: openModal, onDelete: handleDeleteTask }),
                React.createElement(HistoryTable, { 
                    history: filteredHistory, 
                    filters, 
                    setFilters, 
                    shopOptions: [...new Set(history.map(t => t.shopName).filter(Boolean))],
                    staffOptions: [...new Set(history.map(t => t.staffName).filter(Boolean))]
                }),
                isModalOpen && React.createElement(TaskModal, { task: editingTask, onSave: handleSaveTask, onClose: closeModal, shopOptions, staffOptions })
            );
        };

        const Header = ({ onSignOut }) => {
            return React.createElement("header", { className: "flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8" },
                React.createElement("div", { className: "text-center sm:text-left" },
                    React.createElement("h1", { className: "text-3xl sm:text-4xl font-bold text-slate-900" }, "JLW Task Tracker"),
                    React.createElement("p", { className: "text-slate-500 mt-2" }, "Organize your workflow, one task at a time.")
                ),
                React.createElement("button", { onClick: onSignOut, className: "mt-4 sm:mt-0 bg-red-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-75 transition w-full sm:w-auto" }, "Sign Out")
            );
        };

        const KanbanBoard = ({ tasks, onDrop, onEdit, onDelete }) => {
            const columns = [
                { id: 'todo', title: 'To Do', color: 'red-400' },
                { id: 'inprogress', title: 'In Progress', color: 'yellow-400' },
                { id: 'done', title: 'Done', color: 'green-400' },
            ];

            return React.createElement("div", { id: "kanbanBoard", className: "grid grid-cols-1 md:grid-cols-3 gap-6" },
                columns.map(col => React.createElement(KanbanColumn, {
                    key: col.id,
                    status: col.id,
                    title: col.title,
                    color: col.color,
                    tasks: tasks.filter(t => t.status === col.id),
                    onDrop,
                    onEdit,
                    onDelete
                }))
            );
        };

        const KanbanColumn = ({ status, title, color, tasks, onDrop, onEdit, onDelete }) => {
            const columnRef = useRef(null);
            
            useEffect(() => {
                if (!columnRef.current) return;

                const sortable = new Sortable(columnRef.current, {
                    group: 'kanban',
                    animation: 150,
                    ghostClass: 'sortable-ghost',
                    onEnd: (evt) => {
                        const { item, from, to, oldIndex } = evt;

                        if (from !== to) {
                            from.insertBefore(item, from.children[oldIndex] || null);
                            const taskId = item.dataset.id;
                            const newStatus = to.dataset.status;
                            onDrop({ id: taskId }, newStatus);
                        }
                    }
                });

                return () => sortable.destroy();
            }, [onDrop, status]);

            return React.createElement("div", { className: "bg-white rounded-xl shadow-md flex flex-col" },
                React.createElement("div", { className: "p-4 border-b border-slate-200" },
                    React.createElement("h2", { className: "text-lg font-semibold text-slate-700 flex items-center" },
                        React.createElement("span", { className: `w-3 h-3 rounded-full bg-${color} mr-3` }),
                        title
                    )
                ),
                React.createElement("div", { ref: columnRef, "data-status": status, className: "kanban-column-body p-4 flex-grow min-h-[200px] overflow-y-auto" },
                    tasks.map(task => React.createElement(TaskCard, { key: task.id, task, onEdit, onDelete }))
                )
            );
        };

        const TaskCard = ({ task, onEdit, onDelete }) => {
            return React.createElement("div", { "data-id": task.id, className: "task-card bg-slate-50 border border-slate-200 p-4 rounded-lg shadow-sm mb-4 cursor-grab active:cursor-grabbing flex flex-col" },
                React.createElement("div", { className: "flex justify-between items-start" },
                    React.createElement("p", { onClick: () => onEdit(task), className: "text-slate-800 font-semibold flex-grow pr-2" }, task.text),
                    React.createElement("button", { onClick: () => onDelete(task.id), className: "text-slate-400 hover:text-red-500 font-bold text-xl leading-none flex-shrink-0" }, "×")
                ),
                (task.date || task.staffName || task.shopName) && React.createElement("div", { className: "mt-3 pt-3 border-t border-slate-200 text-xs text-slate-500 space-y-1.5" },
                    task.date && React.createElement(InfoRow, { icon: '📅', label: 'Date', value: task.date }),
                    task.staffName && React.createElement(InfoRow, { icon: '�', label: 'Staff', value: task.staffName }),
                    task.shopName && React.createElement(InfoRow, { icon: '🏢', label: 'Shop', value: task.shopName })
                )
            );
        };
        
        const InfoRow = ({ icon, label, value }) => (
            React.createElement("div", { className: "flex items-center" },
                React.createElement("span", { className: "mr-2" }, icon),
                React.createElement("p", null, 
                    React.createElement("span", { className: "font-medium text-slate-600" }, `${label}: `),
                    value
                )
            )
        );

        const HistoryTable = ({ history, filters, setFilters, shopOptions, staffOptions }) => {
            const formatDuration = (ms) => {
                if (!ms || ms < 0) return "0s";
                const seconds = Math.floor((ms / 1000) % 60);
                const minutes = Math.floor((ms / (1000 * 60)) % 60);
                const hours = Math.floor((ms / (1000 * 60 * 60)) % 24);
                const days = Math.floor(ms / (1000 * 60 * 60 * 24));
                const parts = [];
                if (days > 0) parts.push(`${days}d`);
                if (hours > 0) parts.push(`${hours}h`);
                if (minutes > 0) parts.push(`${minutes}m`);
                if (parts.length === 0 && seconds > 0) parts.push(`${seconds}s`);
                if (parts.length === 0) return "0s";
                return parts.slice(0, 2).join(' ');
            };
            
            const formatCompletedDate = (timestamp) => {
                if (!timestamp) return 'N/A';
                return new Date(timestamp.seconds * 1000).toLocaleString('en-US', { dateStyle: 'medium', timeStyle: 'short' });
            };

            return React.createElement("div", { id: "historySection", className: "mt-12" },
                React.createElement("div", { className: "flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4" },
                    React.createElement("h2", { className: "text-2xl font-bold text-slate-800 mb-4 sm:mb-0" }, "Task History"),
                    React.createElement("div", { id: "historyFilters", className: "w-full sm:w-auto flex flex-col sm:flex-row items-center gap-2 sm:gap-4" },
                        React.createElement("select", { value: filters.shop, onChange: e => setFilters({...filters, shop: e.target.value}), className: "w-full sm:w-auto bg-white border border-slate-300 rounded-lg p-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" },
                            React.createElement("option", { value: "" }, "All Shops"),
                            shopOptions.map(name => React.createElement("option", { key: name, value: name }, name))
                        ),
                        React.createElement("select", { value: filters.staff, onChange: e => setFilters({...filters, staff: e.target.value}), className: "w-full sm:w-auto bg-white border border-slate-300 rounded-lg p-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" },
                             React.createElement("option", { value: "" }, "All Staff"),
                            staffOptions.map(name => React.createElement("option", { key: name, value: name }, name))
                        ),
                        React.createElement("input", { type: "date", value: filters.date, onChange: e => setFilters({...filters, date: e.target.value}), className: "w-full sm:w-auto bg-white border border-slate-300 rounded-lg p-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" }),
                        React.createElement("button", { onClick: () => setFilters({ shop: '', staff: '', date: '' }), className: "w-full sm:w-auto bg-slate-200 text-slate-800 font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 text-sm transition" }, "Clear")
                    )
                ),
                React.createElement("div", { className: "bg-white rounded-xl shadow-md overflow-x-auto" },
                    React.createElement("table", { className: "w-full text-left" },
                        React.createElement("thead", { className: "bg-slate-50 border-b border-slate-200" },
                            React.createElement("tr", null,
                                React.createElement("th", { className: "px-2 py-3 sm:p-4 text-sm font-semibold text-slate-600" }, "No"),
                                React.createElement("th", { className: "px-2 py-3 sm:p-4 text-sm font-semibold text-slate-600" }, "Staff Name"),
                                React.createElement("th", { className: "px-2 py-3 sm:p-4 text-sm font-semibold text-slate-600" }, "Shop Name"),
                                React.createElement("th", { className: "px-2 py-3 sm:p-4 text-sm font-semibold text-slate-600" }, "Task"),
                                React.createElement("th", { className: "px-2 py-3 sm:p-4 text-sm font-semibold text-slate-600" }, "Task Duration"),
                                React.createElement("th", { className: "px-2 py-3 sm:p-4 text-sm font-semibold text-slate-600" }, "Completed Date")
                            )
                        ),
                        React.createElement("tbody", null,
                            history.length === 0 ? React.createElement("tr", null, React.createElement("td", { colSpan: "6", className: "p-4 text-center text-slate-400" }, "No matching completed tasks."))
                            : history.map((task, index) => React.createElement("tr", { key: task.id, className: "border-b border-slate-200 hover:bg-slate-50" },
                                React.createElement("td", { className: "px-2 py-3 sm:p-4" }, index + 1),
                                React.createElement("td", { className: "px-2 py-3 sm:p-4" }, task.staffName || 'N/A'),
                                React.createElement("td", { className: "px-2 py-3 sm:p-4" }, task.shopName || 'N/A'),
                                React.createElement("td", { className: "px-2 py-3 sm:p-4" }, task.text),
                                React.createElement("td", { className: "px-2 py-3 sm:p-4 font-medium" }, formatDuration(task.completedTimestamp && task.createdAt ? (task.completedTimestamp.seconds - task.createdAt.seconds) * 1000 : 0)),
                                React.createElement("td", { className: "px-2 py-3 sm:p-4 text-sm text-slate-500" }, formatCompletedDate(task.completedTimestamp))
                            ))
                        )
                    )
                )
            );
        };

        const TaskModal = ({ task, onSave, onClose, shopOptions, staffOptions }) => {
            const [text, setText] = useState(task ? task.text : '');
            const [date, setDate] = useState(task ? task.date : '');
            const [staffName, setStaffName] = useState(task ? task.staffName : '');
            const [shopName, setShopName] = useState(task ? task.shopName : '');

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!text.trim()) return;
                onSave({ text, date, staffName, shopName });
            };

            return React.createElement("div", { className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" },
                React.createElement("div", { className: "bg-white rounded-lg shadow-xl p-8 w-full max-w-md" },
                    React.createElement("h2", { className: "text-2xl font-bold mb-6" }, task ? 'Edit Task' : 'Add a New Task'),
                    React.createElement("form", { onSubmit: handleSubmit },
                        React.createElement("div", { className: "space-y-4" },
                            React.createElement("div", null,
                                React.createElement("label", { htmlFor: "taskDate", className: "block text-sm font-medium text-slate-700 mb-1" }, "Date"),
                                React.createElement("input", { type: "date", id: "taskDate", value: date, onChange: (e) => setDate(e.target.value), className: "w-full border border-slate-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500" })
                            ),
                            React.createElement("div", null,
                                React.createElement("label", { htmlFor: "shopNameSelect", className: "block text-sm font-medium text-slate-700 mb-1" }, "Shop Name"),
                                React.createElement("select", { id: "shopNameSelect", value: shopName, onChange: (e) => setShopName(e.target.value), className: "w-full border border-slate-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500" },
                                    React.createElement("option", { value: "" }, "Select Shop"),
                                    shopOptions.map(name => React.createElement("option", { key: name, value: name }, name))
                                )
                            ),
                            React.createElement("div", null,
                                React.createElement("label", { htmlFor: "staffNameSelect", className: "block text-sm font-medium text-slate-700 mb-1" }, "Staff Name"),
                                React.createElement("select", { id: "staffNameSelect", value: staffName, onChange: (e) => setStaffName(e.target.value), className: "w-full border border-slate-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500" },
                                    React.createElement("option", { value: "" }, "Select Staff"),
                                    staffOptions.map(name => React.createElement("option", { key: name, value: name }, name))
                                )
                            ),
                            React.createElement("div", null,
                                React.createElement("label", { htmlFor: "taskInput", className: "block text-sm font-medium text-slate-700 mb-1" }, "Task Description"),
                                React.createElement("textarea", { id: "taskInput", value: text, onChange: (e) => setText(e.target.value), className: "w-full border border-slate-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500", rows: "3", placeholder: "Enter task description..." })
                            )
                        ),
                        React.createElement("div", { className: "mt-6 flex justify-end space-x-4" },
                            React.createElement("button", { type: "button", onClick: onClose, className: "bg-slate-200 text-slate-800 font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 transition" }, "Cancel"),
                            React.createElement("button", { type: "submit", className: "bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition" }, "Save Task")
                        )
                    )
                )
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(AuthProvider, null, React.createElement(App)));

    </script>
</body>
</html>
